{"version":3,"file":"accounts.js","sourceRoot":"","sources":["../../../../src/programs/rewardDistributor/accounts.ts"],"names":[],"mappings":";;;AACA,8CAA8D;AAG9D,wBAAuE;AAEvE,2CAAuD;AAEhD,MAAM,cAAc,GAAG,KAAK,EACjC,UAAsB,EACtB,aAAwB,EACxB,UAAuB,EACgB,EAAE;IACzC,MAAM,OAAO,GAAG,IAAA,oCAAwB,EAAC,UAAU,EAAE,SAAS,EAAE;QAC9D,UAAU;KACX,CAAC,CAAC;IACH,MAAM,MAAM,GAAG,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CACrD,aAAa,CACd,CAAoB,CAAC;IACtB,OAAO;QACL,MAAM;QACN,MAAM,EAAE,aAAa;KACtB,CAAC;AACJ,CAAC,CAAC;AAfW,QAAA,cAAc,kBAezB;AAEK,MAAM,gBAAgB,GAAG,KAAK,EACnC,UAAsB,EACtB,cAA2B,EAC3B,UAAuB,EACkB,EAAE;IAC3C,MAAM,OAAO,GAAG,IAAA,oCAAwB,EAAC,UAAU,EAAE,SAAS,EAAE;QAC9D,UAAU;KACX,CAAC,CAAC;IACH,MAAM,aAAa,GAAG,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,aAAa,CACpE,cAAc,CACf,CAAsB,CAAC;IACxB,OAAO,aAAa,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QACtC,MAAM,EAAE,KAAK;QACb,MAAM,EAAE,cAAc,CAAC,CAAC,CAAE;KAC3B,CAAC,CAAC,CAAC;AACN,CAAC,CAAC;AAfW,QAAA,gBAAgB,oBAe3B;AAEK,MAAM,oBAAoB,GAAG,KAAK,EACvC,UAAsB,EACtB,mBAA8B,EAC9B,UAAuB,EACsB,EAAE;IAC/C,MAAM,OAAO,GAAG,IAAA,oCAAwB,EAAC,UAAU,EAAE,SAAS,EAAE;QAC9D,UAAU;KACX,CAAC,CAAC;IACH,MAAM,MAAM,GAAG,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,CAC3D,mBAAmB,CACpB,CAA0B,CAAC;IAC5B,OAAO;QACL,MAAM;QACN,MAAM,EAAE,mBAAmB;KAC5B,CAAC;AACJ,CAAC,CAAC;AAfW,QAAA,oBAAoB,wBAe/B;AAEK,MAAM,qBAAqB,GAAG,KAAK,EACxC,UAAsB,EACtB,oBAAiC,EACjC,UAAuB,EACwB,EAAE;IACjD,MAAM,OAAO,GAAG,IAAA,oCAAwB,EAAC,UAAU,EAAE,SAAS,EAAE;QAC9D,UAAU;KACX,CAAC,CAAC;IACH,MAAM,kBAAkB,GACtB,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,iBAAiB,CAAC,aAAa,CACpD,oBAAoB,CACrB,CAA4B,CAAC;IAChC,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QACjD,MAAM,EAAE,WAAW;QACnB,MAAM,EAAE,oBAAoB,CAAC,CAAC,CAAE;KACjC,CAAC,CAAC,CAAC;AACN,CAAC,CAAC;AAhBW,QAAA,qBAAqB,yBAgBhC;AAEK,MAAM,oCAAoC,GAAG,KAAK,EACvD,UAAsB,EACtB,mBAA8B,EAC9B,UAAuB,EACkB,EAAE;IAC3C,MAAM,eAAe,GAAG,MAAM,UAAU,CAAC,kBAAkB,CACzD,6BAA0B,EAC1B;QACE,OAAO,EAAE;YACP;gBACE,MAAM,EAAE;oBACN,MAAM,EAAE,CAAC;oBACT,KAAK,EAAE,cAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAC5B,2BAAkB,CAAC,oBAAoB,CAAC,aAAa,CAAC,CACvD;iBACF;aACF;YACD;gBACE,MAAM,EAAE;oBACN,MAAM,EAAE,EAAE;oBACV,KAAK,EAAE,mBAAmB,CAAC,QAAQ,EAAE;iBACtC;aACF;SACF;QACD,UAAU;KACX,CACF,CAAC;IACF,MAAM,gBAAgB,GAAmC,EAAE,CAAC;IAC5D,MAAM,KAAK,GAAG,IAAI,2BAAkB,CAAC,yBAAsB,CAAC,CAAC;IAC7D,eAAe,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QAClC,IAAI;YACF,MAAM,eAAe,GAAoB,KAAK,CAAC,MAAM,CACnD,aAAa,EACb,OAAO,CAAC,OAAO,CAAC,IAAI,CACrB,CAAC;YACF,IAAI,eAAe,EAAE;gBACnB,gBAAgB,CAAC,IAAI,CAAC;oBACpB,GAAG,OAAO;oBACV,MAAM,EAAE,eAAe;iBACxB,CAAC,CAAC;aACJ;YACD,oCAAoC;SACrC;QAAC,OAAO,CAAC,EAAE,GAAE;IAChB,CAAC,CAAC,CAAC;IACH,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACpC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CACvD,CAAC;AACJ,CAAC,CAAC;AA/CW,QAAA,oCAAoC,wCA+C/C;AAEK,MAAM,mBAAmB,GAAG,KAAK,EACtC,UAAsB,EACtB,UAAuB,EACkB,EAAE;IAC3C,MAAM,eAAe,GAAG,MAAM,UAAU,CAAC,kBAAkB,CACzD,6BAA0B,EAC1B;QACE,OAAO,EAAE;YACP;gBACE,MAAM,EAAE;oBACN,MAAM,EAAE,CAAC;oBACT,KAAK,EAAE,cAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAC5B,2BAAkB,CAAC,oBAAoB,CAAC,aAAa,CAAC,CACvD;iBACF;aACF;SACF;QACD,UAAU;KACX,CACF,CAAC;IACF,MAAM,gBAAgB,GAAmC,EAAE,CAAC;IAC5D,MAAM,KAAK,GAAG,IAAI,2BAAkB,CAAC,yBAAsB,CAAC,CAAC;IAC7D,eAAe,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QAClC,IAAI;YACF,MAAM,eAAe,GAAoB,KAAK,CAAC,MAAM,CACnD,aAAa,EACb,OAAO,CAAC,OAAO,CAAC,IAAI,CACrB,CAAC;YACF,IAAI,eAAe,EAAE;gBACnB,gBAAgB,CAAC,IAAI,CAAC;oBACpB,GAAG,OAAO;oBACV,MAAM,EAAE,eAAe;iBACxB,CAAC,CAAC;aACJ;YACD,oCAAoC;SACrC;QAAC,OAAO,CAAC,EAAE,GAAE;IAChB,CAAC,CAAC,CAAC;IACH,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CACpC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CACvD,CAAC;AACJ,CAAC,CAAC;AAxCW,QAAA,mBAAmB,uBAwC9B","sourcesContent":["import type { AccountData } from \"@cardinal/common\";\r\nimport { BorshAccountsCoder, utils } from \"@coral-xyz/anchor\";\r\nimport type { Commitment, Connection, PublicKey } from \"@solana/web3.js\";\r\n\r\nimport { REWARD_DISTRIBUTOR_ADDRESS, REWARD_DISTRIBUTOR_IDL } from \".\";\r\nimport type { RewardDistributorData, RewardEntryData } from \"./constants\";\r\nimport { rewardDistributorProgram } from \"./constants\";\r\n\r\nexport const getRewardEntry = async (\r\n  connection: Connection,\r\n  rewardEntryId: PublicKey,\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardEntryData>> => {\r\n  const program = rewardDistributorProgram(connection, undefined, {\r\n    commitment,\r\n  });\r\n  const parsed = (await program.account.rewardEntry.fetch(\r\n    rewardEntryId\r\n  )) as RewardEntryData;\r\n  return {\r\n    parsed,\r\n    pubkey: rewardEntryId,\r\n  };\r\n};\r\n\r\nexport const getRewardEntries = async (\r\n  connection: Connection,\r\n  rewardEntryIds: PublicKey[],\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardEntryData>[]> => {\r\n  const program = rewardDistributorProgram(connection, undefined, {\r\n    commitment,\r\n  });\r\n  const rewardEntries = (await program.account.rewardEntry.fetchMultiple(\r\n    rewardEntryIds\r\n  )) as RewardEntryData[];\r\n  return rewardEntries.map((entry, i) => ({\r\n    parsed: entry,\r\n    pubkey: rewardEntryIds[i]!,\r\n  }));\r\n};\r\n\r\nexport const getRewardDistributor = async (\r\n  connection: Connection,\r\n  rewardDistributorId: PublicKey,\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardDistributorData>> => {\r\n  const program = rewardDistributorProgram(connection, undefined, {\r\n    commitment,\r\n  });\r\n  const parsed = (await program.account.rewardDistributor.fetch(\r\n    rewardDistributorId\r\n  )) as RewardDistributorData;\r\n  return {\r\n    parsed,\r\n    pubkey: rewardDistributorId,\r\n  };\r\n};\r\n\r\nexport const getRewardDistributors = async (\r\n  connection: Connection,\r\n  rewardDistributorIds: PublicKey[],\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardDistributorData>[]> => {\r\n  const program = rewardDistributorProgram(connection, undefined, {\r\n    commitment,\r\n  });\r\n  const rewardDistributors =\r\n    (await program.account.rewardDistributor.fetchMultiple(\r\n      rewardDistributorIds\r\n    )) as RewardDistributorData[];\r\n  return rewardDistributors.map((distributor, i) => ({\r\n    parsed: distributor,\r\n    pubkey: rewardDistributorIds[i]!,\r\n  }));\r\n};\r\n\r\nexport const getRewardEntriesForRewardDistributor = async (\r\n  connection: Connection,\r\n  rewardDistributorId: PublicKey,\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardEntryData>[]> => {\r\n  const programAccounts = await connection.getProgramAccounts(\r\n    REWARD_DISTRIBUTOR_ADDRESS,\r\n    {\r\n      filters: [\r\n        {\r\n          memcmp: {\r\n            offset: 0,\r\n            bytes: utils.bytes.bs58.encode(\r\n              BorshAccountsCoder.accountDiscriminator(\"rewardEntry\")\r\n            ),\r\n          },\r\n        },\r\n        {\r\n          memcmp: {\r\n            offset: 41,\r\n            bytes: rewardDistributorId.toBase58(),\r\n          },\r\n        },\r\n      ],\r\n      commitment,\r\n    }\r\n  );\r\n  const rewardEntryDatas: AccountData<RewardEntryData>[] = [];\r\n  const coder = new BorshAccountsCoder(REWARD_DISTRIBUTOR_IDL);\r\n  programAccounts.forEach((account) => {\r\n    try {\r\n      const rewardEntryData: RewardEntryData = coder.decode(\r\n        \"rewardEntry\",\r\n        account.account.data\r\n      );\r\n      if (rewardEntryData) {\r\n        rewardEntryDatas.push({\r\n          ...account,\r\n          parsed: rewardEntryData,\r\n        });\r\n      }\r\n      // eslint-disable-next-line no-empty\r\n    } catch (e) {}\r\n  });\r\n  return rewardEntryDatas.sort((a, b) =>\r\n    a.pubkey.toBase58().localeCompare(b.pubkey.toBase58())\r\n  );\r\n};\r\n\r\nexport const getAllRewardEntries = async (\r\n  connection: Connection,\r\n  commitment?: Commitment\r\n): Promise<AccountData<RewardEntryData>[]> => {\r\n  const programAccounts = await connection.getProgramAccounts(\r\n    REWARD_DISTRIBUTOR_ADDRESS,\r\n    {\r\n      filters: [\r\n        {\r\n          memcmp: {\r\n            offset: 0,\r\n            bytes: utils.bytes.bs58.encode(\r\n              BorshAccountsCoder.accountDiscriminator(\"rewardEntry\")\r\n            ),\r\n          },\r\n        },\r\n      ],\r\n      commitment,\r\n    }\r\n  );\r\n  const rewardEntryDatas: AccountData<RewardEntryData>[] = [];\r\n  const coder = new BorshAccountsCoder(REWARD_DISTRIBUTOR_IDL);\r\n  programAccounts.forEach((account) => {\r\n    try {\r\n      const rewardEntryData: RewardEntryData = coder.decode(\r\n        \"rewardEntry\",\r\n        account.account.data\r\n      );\r\n      if (rewardEntryData) {\r\n        rewardEntryDatas.push({\r\n          ...account,\r\n          parsed: rewardEntryData,\r\n        });\r\n      }\r\n      // eslint-disable-next-line no-empty\r\n    } catch (e) {}\r\n  });\r\n  return rewardEntryDatas.sort((a, b) =>\r\n    a.pubkey.toBase58().localeCompare(b.pubkey.toBase58())\r\n  );\r\n};\r\n"]}